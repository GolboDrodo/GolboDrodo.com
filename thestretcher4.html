<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>stretch</title>
  <style>
    body {
      margin: 0;
      display: grid;
      grid-template-rows: auto auto auto;
      justify-items: center;
      align-content: center;
      gap: 16px;
      font-family: sans-serif;
    }

    #header {
      background: #ffffff00;
      color: rgb(0, 13, 255);
      font-size: 24px;
      text-align: center;
      padding-top: 20px;
      font-weight: bold;

    }

    #image-container {
      display: grid;
      justify-items: center;
      align-items: center;
      gap: 12px;
    }

    #drag-instruction {
      color: #888;
      font-family: monospace;
      font-size: 16px;
      text-align: center;
    }

    /* Nascondo input file */
    #file-input {
      display: none;
    }

    .file-label {
      display: inline-block;
      padding: 4px 10px;
      font-size: 20px;
      cursor: pointer;
      background-color: rgb(0, 0, 255);
      border: 1px solid #00000000;
      border-radius: 14pt;
      transition: 0.5s;
      text-align: center;
      color: white;
    }
    .file-label:hover {
      background-color: rgb(225, 0, 0);
      color: #fff;
    }

    #image-wrapper {
      position: relative;
      display: none;
      border: 3px dashed rgb(0, 0, 255);
      margin: 0 auto;
    }

    #myImage {
      display: block;
      width: 300px;
      height: auto;
      max-width: 90vw;
      max-height: 60svh;
    }

    /* Bordi */
    .edge { position: absolute; background: transparent; }
    .edge.top    { top: -3px; left: 0; width: 100%; height: 6px; cursor: ns-resize; }
    .edge.bottom { bottom: -3px; left: 0; width: 100%; height: 6px; cursor: ns-resize; }
    .edge.left   { top: 0; left: -3px; width: 6px; height: 100%; cursor: ew-resize; }
    .edge.right  { top: 0; right: -3px; width: 6px; height: 100%; cursor: ew-resize; }

    /* Angoli */
    .corner {
      position: absolute;
      width: 12px;
      height: 12px;
      background: rgba(255,0,0,0);
      border-radius: 50%;
      z-index: 10;
    }
    .corner.tl { top: 0; left: 0; transform: translate(-50%, -50%); cursor: nwse-resize; }
    .corner.tr { top: 0; right: 0; transform: translate(50%, -50%); cursor: nesw-resize; }
    .corner.bl { bottom: 0; left: 0; transform: translate(-50%, 50%); cursor: nesw-resize; }
    .corner.br { bottom: 0; right: 0; transform: translate(50%, 50%); cursor: nwse-resize; }

    .controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
    }

    button {
      padding: 4px 10px;
      font-size: 20px;
      cursor: pointer;
      background-color: rgb(255, 230, 71);
      border: 1px solid #00000000;
      border-radius: 14pt;
      transition: 0.5s;
    }
    button:hover {
      background-color: red;
      color: #fff;
    }
    p{
        margin: 0;
    }
  </style>
</head>
<body>

  <div id="header">STRETCH</div>

  <div id="image-container">
    <div id="drag-instruction">Trascina un'immagine qui o carica dal dispositivo</div>
    <label for="file-input" class="file-label">carica..</label>
    <input type="file" id="file-input" accept="image/*">
    <div id="image-wrapper">
      <img id="myImage" alt="Carica un'immagine" />
      <!-- Bordi -->
      <div class="edge top"></div>
      <div class="edge right"></div>
      <div class="edge bottom"></div>
      <div class="edge left"></div>
      <!-- Angoli -->
      <div class="corner tl"></div>
      <div class="corner tr"></div>
      <div class="corner bl"></div>
      <div class="corner br"></div>
    </div>
  </div>

  <div class="controls">
    <button onclick="downloadImage()">scarica</button>
  </div>
  <p><a href="index.html">home</a></p>

  <script>
    const img = document.getElementById("myImage");
    const wrapper = document.getElementById("image-wrapper");
    const instruction = document.getElementById("drag-instruction");
    const fileInput = document.getElementById("file-input");

    let startX, startY, startWidth, startHeight, activeHandle;

    function showImageUI() {
      wrapper.style.display = "inline-block";
      instruction.style.display = "none";
    }

    function fitImage() {
      const scale = 0.4;
      const maxW = Math.min(window.innerWidth * scale, img.naturalWidth);
      const maxH = Math.min(window.innerHeight * scale, img.naturalHeight);
      const wScale = maxW / img.naturalWidth;
      const hScale = maxH / img.naturalHeight;
      const finalScale = Math.min(wScale, hScale);

      img.style.width = Math.max(50, Math.round(img.naturalWidth * finalScale)) + "px";
      img.style.height = Math.max(50, Math.round(img.naturalHeight * finalScale)) + "px";
    }

    function loadImage(file) {
      if (file && file.type.startsWith("image/")) {
        const reader = new FileReader();
        reader.onload = (event) => {
          img.src = event.target.result;
          img.onload = () => {
            showImageUI();
            fitImage();
          };
        };
        reader.readAsDataURL(file);
      }
    }

    fileInput.addEventListener("change", (e) => {
      loadImage(e.target.files[0]);
    });

    document.addEventListener("dragover", (e) => e.preventDefault());
    document.addEventListener("drop", (e) => {
      e.preventDefault();
      loadImage(e.dataTransfer.files[0]);
    });

    // Gestione resize
    document.querySelectorAll(".edge, .corner").forEach(handle => {
      handle.addEventListener("mousedown", e => {
        e.preventDefault();
        startX = e.clientX;
        startY = e.clientY;
        startWidth = img.clientWidth;
        startHeight = img.clientHeight;

        if (handle.classList.contains("right")) activeHandle = "right";
        else if (handle.classList.contains("left")) activeHandle = "left";
        else if (handle.classList.contains("bottom")) activeHandle = "bottom";
        else if (handle.classList.contains("top")) activeHandle = "top";
        else if (handle.classList.contains("tl")) activeHandle = "tl";
        else if (handle.classList.contains("tr")) activeHandle = "tr";
        else if (handle.classList.contains("bl")) activeHandle = "bl";
        else if (handle.classList.contains("br")) activeHandle = "br";

        document.addEventListener("mousemove", resize);
        document.addEventListener("mouseup", stopResize);
      });
    });

    function resize(e) {
      if (!activeHandle) return;
      let newWidth = startWidth;
      let newHeight = startHeight;

      if (activeHandle === "right") {
        newWidth = startWidth + (e.clientX - startX);
      } else if (activeHandle === "left") {
        newWidth = startWidth - (e.clientX - startX);
      } else if (activeHandle === "bottom") {
        newHeight = startHeight + (e.clientY - startY);
      } else if (activeHandle === "top") {
        newHeight = startHeight - (e.clientY - startY);
      } else if (activeHandle === "br") {
        newWidth = startWidth + (e.clientX - startX);
        newHeight = startHeight + (e.clientY - startY);
      } else if (activeHandle === "bl") {
        newWidth = startWidth - (e.clientX - startX);
        newHeight = startHeight + (e.clientY - startY);
      } else if (activeHandle === "tr") {
        newWidth = startWidth + (e.clientX - startX);
        newHeight = startHeight - (e.clientY - startY);
      } else if (activeHandle === "tl") {
        newWidth = startWidth - (e.clientX - startX);
        newHeight = startHeight - (e.clientY - startY);
      }

      if (newWidth > 20) img.style.width = newWidth + "px";
      if (newHeight > 20) img.style.height = newHeight + "px";
    }

    function stopResize() {
      document.removeEventListener("mousemove", resize);
      document.removeEventListener("mouseup", stopResize);
      activeHandle = null;
    }

    function downloadImage() {
      if (!img.src) return;
      const canvas = document.createElement("canvas");
      canvas.width = img.clientWidth;
      canvas.height = img.clientHeight;
      const ctx = canvas.getContext("2d");
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      const link = document.createElement("a");
      link.download = "stretched-image.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    }
  </script>

</body>
</html>
